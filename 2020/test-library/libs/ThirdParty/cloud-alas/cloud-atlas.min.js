/*!
 * cloud-atlas-web-sdk v1.7.2-independent-device
 * (c) 2017-2019 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CloudAtlas=t()}(this,function(){"use strict";var n="[CloudAtlas] ",i="device_id",c=localStorage,k="ca_label",S="ca_int_value",s="leave_page_info";function u(){function i(e){for(var t=this.sessionList.length,n=0;n<t;n++){var r=this.sessionList[n];if(e.id===r.id)return r}return null}this.sessionList=[],this.eventList=[],this.errorList=[],this.merge=function(e){if(e){if(0<e.sessionList.length)for(var t=e.sessionList.length,n=0;n<t;n++){var r=e.sessionList[n];if(r&&r.id){var o=i.apply(this,[r]);null===o?this.sessionList.push(r):r.end>o.end&&(o.end=r.end)}}e.eventList&&0<e.eventList.length&&(this.eventList=this.eventList.concat(e.eventList)),e.errorList&&0<e.errorList.length&&(this.errorList=this.errorList.concat(e.errorList))}},this.hasValidData=function(){return 0<this.sessionList.length||0<this.eventList.length||0<this.errorList.length}}function m(e,t,n,r,o,i,a){this.id=e,this.start=t,this.end=n,this.userId=r,this.appVer=o,this.ip=i,this.activityId=a,this.equals=function(e){return this===e||null!==e&&this.constructor===e.constructor&&(this.id===e.id&&(this.start===e.start&&(this.end===e.end&&(this.userId===e.userId&&(this.appVer===e.appVer&&(this.activityId===e.activityId&&this.ip===e.ip))))))}}function l(e,t,n,r){this.appVer=e,this.userId=t,this.sessionId=n,this.ip=r}function d(e,t,n,r,o,i,a){this.id=e,this.value=t,this.time=n,this.userId=r,this.appVer=o,this.activityId=i,this.sessionId=a,this.equals=function(e){return this===e||null!==e&&this.constructor===e.constructor&&(this.id===e.id&&(this.value===e.value&&(this.time===e.time&&(this.userId===e.userId&&(this.activityId===e.activityId&&(this.sessionId===e.sessionId&&this.appVer!==e.appVer))))))}}function a(e,t,n,r,o){this.type=e,this.msg=t,this.time=n,this.appVer=r,this.activityId=o,this.equals=function(e){return this===e||null!==e&&this.constructor===e.constructor&&(this.type===e.type&&(this.msg===e.msg&&(this.time===e.time&&(this.activityId===e.activityId&&this.appVer!==event.appVer))))}}function e(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})}var t=setTimeout;function r(){}function f(e){if(!(this instanceof f))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],y(e,this)}function o(r,o){for(;3===r._state;)r=r._value;0!==r._state?(r._handled=!0,f._immediateFn(function(){var e=1===r._state?o.onFulfilled:o.onRejected;if(null!==e){var t;try{t=e(r._value)}catch(n){return void v(o.promise,n)}p(o.promise,t)}else(1===r._state?p:v)(o.promise,r._value)})):r._deferreds.push(o)}function p(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof f)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void y(function r(e,t){return function(){e.apply(t,arguments)}}(n,t),e)}e._state=1,e._value=t,h(e)}catch(o){v(e,o)}}function v(e,t){e._state=2,e._value=t,h(e)}function h(e){2===e._state&&0===e._deferreds.length&&f._immediateFn(function(){e._handled||f._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function g(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function y(e,t){var n=!1;try{e(function(e){n||(n=!0,p(t,e))},function(e){n||(n=!0,v(t,e))})}catch(r){if(n)return;n=!0,v(t,r)}}f.prototype["catch"]=function(e){return this.then(null,e)},f.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new g(e,t,n)),n},f.prototype["finally"]=e,f.all=function(t){return new f(function(o,i){if(!t||"undefined"==typeof t.length)throw new TypeError("Promise.all accepts an array");var a=Array.prototype.slice.call(t);if(0===a.length)return o([]);var s=a.length;function c(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){c(t,e)},i)}a[t]=e,0==--s&&o(a)}catch(r){i(r)}}for(var e=0;e<a.length;e++)c(e,a[e])})},f.resolve=function(t){return t&&"object"==typeof t&&t.constructor===f?t:new f(function(e){e(t)})},f.reject=function(n){return new f(function(e,t){t(n)})},f.race=function(o){return new f(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},f._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},f._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var w=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in w?w.Promise.prototype["finally"]||(w.Promise.prototype["finally"]=e):w.Promise=f;var O=void 0;function x(){try{var e="localStorage"in window&&null!==window.localStorage;return e&&(c.setItem("___testSetItem__","___testSetItem__"),c.removeItem("___testSetItem__")),e}catch(t){return ne("\u60a8\u7684\u6d4f\u89c8\u5668\u7248\u672c\u4e0d\u652f\u6301localstorage"),!1}}function b(){if(x()){for(var e=0,t=new u,n=[],r=0;r<c.length;r++){var o=c.key(r);if(/^atlas_data/.test(o)){e++,n.push(o);var i=c.getItem(o);if(window.atob)try{i=decodeURIComponent(window.atob(i))}catch(s){ne("\u89e3\u6790localstorage\u5931\u8d25")}var a=i;try{a=JSON.parse(i)}catch(s){continue}switch(o.split("_")[2]){case"0":t.sessionList.push(a);break;case"1":t.eventList.push(a);break;case"2":t.errorList.push(a)}}if(J<=e){e=0;break}}return{data:t,keys:n}}return null}function I(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:0,t=arguments[1];if(x()){var n="atlas_data_"+e+"_"+A(),r=JSON.stringify(t);window.btoa&&(r=window.btoa(encodeURIComponent(r))),c.setItem(n,r)}}function E(e){if(x()&&e!==undefined&&null!==e)for(var t=0;t<e.length;t++){var n=e[t];c.removeItem(n)}}function L(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n},writable:!0,configurable:!0}),Object.assign.apply(Object,[e].concat(n))}O=A();var N=void 0,T=void 0,C=void 0;function A(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function j(e){var t=void 0,n=void 0,r=void 0,o=void 0,i=void 0,a=0,s=e.length;for(i=0;i<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),a+=n<128?1:n<2048?2:n<65536?3:4;for(o=new Uint8Array(a),i=t=0;t<a;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),o[t++]=n<128?n:(o[t++]=n<2048?192|n>>>6:(o[t++]=n<65536?224|n>>>12:(o[t++]=240|n>>>18,128|n>>>12&63),128|n>>>6&63),128|63&n);return o}function P(){return new Promise(function(e){e(O||A())})}function V(){var e=function n(){return x()?c.getItem(i):null}()||"{}",t=void 0;try{t=JSON.parse(e)}catch(r){ne("Resolve deviceInfo failed",r)}t&&t.deviceId?ee("Resolve exist deviceId : "+(O=t.deviceId)):function o(){return new Promise(function(e){e(A())})}().then(function(e){O=e,function t(e){x()&&c.setItem(i,e)}(JSON.stringify({deviceId:O})),ee("No exist deviceId, generate one : "+O)})}function R(){return(new Date).getTime()}function F(e){function t(e){var t=Math.abs(Math.floor(e));return(t<10?"0":"")+t}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())+function n(e){return(0<=-e?"+":"-")+t(e/60)+t(e%60)}(e.getTimezoneOffset())}function D(c,u,l){var d={link:{src:"href",defaultAttr:"rel",textType:"stylesheet"},script:{src:"src",defaultAttr:"type",textType:"text/javascript"}}[u];return new Promise(function(t,n){var r=document.createElement(u);if(r.addEventListener("load",function(e){document.body.appendChild(r),t(e)},!1),r.addEventListener("error",function(e){document.body.removeChild(r),n(e)},!1),l){var e=Object.keys(l),o=Array.isArray(e),i=0;for(e=o?e:e[Symbol.iterator]();;){var a;if(o){if(i>=e.length)break;a=e[i++]}else{if((i=e.next()).done)break;a=i.value}var s=a;r.setAttribute(s,l[s])}}r[d.src]=c,r[d.defaultAttr]=d.textType,document.head.appendChild(r)})}var M=!1,U=!1,q=null,W=!0;var z="http://cloud-atlas-collection.oth.web.sdp.101.com/",J=5,K="http://cloud-atlas-server.pre1.web.nd/";function $(e){J=e}function H(){q=A()}var X,B,G=((X={vendorCss:"",modalJs:"",vendorJs:""}).vendorCss=(B="https://cdncs.101.com/v0.1/static/cloudatlas_cs/websdk")+"/v1.7.2/vendor.css",X.vendorJs=B+"/v1.7.2/vendor.js",X);function Y(e){var t=void 0;switch(e){case"DEVELOPMENT":t=" http://cloud-atlas-server.dev.web.nd/";break;case"DEBUG":t="http://cloud-atlas-server.debug.web.nd/";break;case"INTEGRATION":t="http://cloud-atlas-server.pre1.web.nd/";break;case"PREPRODUCTION":t="https://cloud-atlas-server.beta.101.com/";break;case"PRODUCTION":t="https://cloud-atlas-server.sdp.101.com/";break;default:t="https://cloud-atlas-server.sdp.101.com/"}return t}var Q,Z=window.console||((Q={}).log=Q.warn=Q.debug=Q.info=Q.error=Q.time=Q.dir=Q.profile=Q.clear=Q.exception=Q.trace=Q.assert=function(e){},Q);function ee(e){U&&Z.log&&Z.log(n+e)}function te(e){U&&Z.warn&&Z.warn(n+e)}function ne(e,t){Z.error&&Z.error(n+e+(t?"\nerror = "+t:""))}function re(e){var t="onhashchange"in window?"hashchange":"popstate";ie(window,t,e)}function oe(e){var t=function r(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";ie(document,n,e)}else ne("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301visibilitychange\u76d1\u542c\u4e8b\u4ef6")}function ie(){function u(e){return e&&(e.preventDefault=u.preventDefault,e.stopPropagation=u.stopPropagation,e._getPath=u._getPath),e}u._getPath=function(){var r=this,o=function o(){try{var e=r.target,t=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)e=e.parentElement,t.unshift(e);return t}catch(n){return[]}};return this.path||this.composedPath&&this.composedPath()||o()},u.preventDefault=function(){this.returnValue=!1},u.stopPropagation=function(){this.cancelBubble=!0},function i(e,t,n){if(e&&e.addEventListener)e.addEventListener(t,function(e){e._getPath=u._getPath,n.call(this,e)},!1);else{var r="on"+t,o=e[r];e[r]=function c(o,i,a){return function s(e){if(!(e=e||u(window.event)))return undefined;e.target=e.srcElement;var t=!0,n=void 0;"function"==typeof a&&(n=a(e));var r=i.call(o,e);return!1!==n&&!1!==r||(t=!1),t}}(e,n,o)}}.apply(null,arguments)}function ae(){var e={};return e.os_system=function p(){var e=navigator.userAgent,t="Win32"==navigator.platform||"Win64"==navigator.platform||"Windows"==navigator.platform,n="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(n)return"Mac";if("X11"==navigator.platform&&!t&&!n)return"Unix";var r=-1<String(navigator.platform).indexOf("Linux"),o="android"==e.toLowerCase().match(/android/i);if(r)return o?"Android":"Linux";if(t){var i=-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000");if(i)return"Win2000";var a=-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP");if(a)return"WinXP";var s=-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003");if(s)return"Win2003";var c=-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista");if(c)return"WinVista";var u=-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7");if(u)return"Win7";var l=-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8");if(l)return"Win8";var d=-1<e.indexOf("Windows NT 6.3")||-1<e.indexOf("Windows 8.1");if(d)return"Win8.1";var f=-1<e.indexOf("Windows NT 6.4")||-1<e.indexOf("Windows NT 10.0")||-1<e.indexOf("Windows 10");return f?"Win10":"other"}}(),e}var se="browser_";function ce(){var e={},t=function v(){var e={},t=navigator.userAgent,n=-1<t.indexOf("Opera");if(n){if("Opera"===navigator.appName)e.version=parseFloat(navigator.appVersion);else{var r=new RegExp("Opera (\\d+.\\d+)");r.test(t),e.version=parseFloat(RegExp.$1)}e.opera=!0,e.name="opera"}var o=-1<t.indexOf("Chrome");if(o){var i=new RegExp("Chrome/(\\d+\\.\\d+(?:\\.\\d+\\.\\d+))?");i.test(t),e.version=parseFloat(RegExp.$1),e.chrome=!0,e.name="chrome"}var a=(-1<t.indexOf("KHTML")||-1<t.indexOf("Konqueror")||-1<t.indexOf("AppleWebKit"))&&!o;if(a){var s=-1<t.indexOf("AppleWebKit"),c=-1<t.indexOf("Konqueror");if(s){var u=new RegExp("Version/(\\d+(?:\\.\\d*)?)");u.test(t),e.version=parseFloat(RegExp.$1),e.safari=!0,e.name="safari"}else if(c){var l=new RegExp("Konqueror\\/(\\d+(?:\\.\\d+(?:\\.\\d)?)?)");l.test(t),e.version=parseFloat(RegExp.$1),e.konqueror=!0,e.name="konqueror"}}if(-1<t.indexOf("compatible")&&-1<t.indexOf("MSIE")&&!n||-1<t.indexOf("Trident")&&-1<t.indexOf("rv:11.0")&&!n){var d=new RegExp("MSIE (\\d+\\.\\d+);");d.test(t),e.version=parseFloat(RegExp.$1),e.msie=!0,e.name="Trident"}if(-1<t.indexOf("Gecko")&&!o&&!a){var f=new RegExp("rv:(\\d+\\.\\d+(?:\\.\\d+)?)");f.test(t),e.version=parseFloat(RegExp.$1),e.mozilla=!0,e.name="mozilla"}if(-1<t.indexOf("Edge")){var p=new RegExp("Edge (\\d+\\.\\d+);");p.test(t),e.version=parseFloat(RegExp.$1),e.edge=!0,e.name="Edge"}return e}();return e.kernel=t.name,e}function ue(){var e=window.document,n=window.navigator.userAgent.toLowerCase(),t=e.documentMode,r=window.chrome||!1,o={agent:n,isEdge:/edge/.test(n),isIE:/msie/.test(n)||/trident/.test(n)&&/rv:11.0/.test(n),isGecko:0<n.indexOf("gecko")&&n.indexOf("like gecko")<0,isWebkit:0<n.indexOf("webkit"),isStrict:"CSS1Compat"===e.compatMode,supportSubTitle:function(){return"track"in e.createElement("track")},supportScope:function(){return"scoped"in e.createElement("style")},ieVersion:function(){try{return n.match(/msie ([\d.]+)/)[1]||n.match(/rv: ([\d.]+)/)[1]||0}catch(e){return ee("error"),t}},edgeVersion:function(){try{return n.match(/edge\/([\d.]+)/)[1]||0}catch(e){return ee("error"),t}},operaVersion:function(){try{if(window.opera)return n.match(/opera.([\d.]+)/)[1];if(0<n.indexOf("opr"))return n.match(/opr\/([\d.]+)/)[1]}catch(e){return ee("error"),0}},versionFilter:function(){if(1!==arguments.length||"string"!=typeof arguments[0])return 1===arguments.length?arguments[0]:0;var e=arguments[0],t=e.indexOf(".");if(0<t){var n=e.indexOf(".",t+1);if(-1!==n)return e.substr(0,n)}return e}};try{o.type=o.isEdge?"Edge":o.isIE?"IE":window.opera||0<n.indexOf("opr")?"Opera":0<n.indexOf("chrome")?"Chrome":window.openDatabase?"Safari":0<n.indexOf("firefox")?"Firefox":"unkonw",o.version="Edge"===o.type?o.edgeVersion():"IE"===o.type?o.ieVersion():"Firefox"===o.type?n.match(/firefox\/([\d.]+)/)[1]:"Chrome"===o.type?n.match(/chrome\/([\d.]+)/)[1]:"Opera"===o.type?o.operaVersion():"Safari"===o.type?n.match(/version\/([\d.]+)/)[1]:"0",o.shell=function(){if(0<n.indexOf("maxthon"))return o.version=n.match(/maxthon\/([\d.]+)/)[1]||o.version,"\u50b2\u6e38\u6d4f\u89c8\u5668";if(0<n.indexOf("qqbrowser"))return o.version=n.match(/qqbrowser\/([\d.]+)/)[1]||o.version,"QQ\u6d4f\u89c8\u5668";if(0<n.indexOf("se 2.x"))return"\u641c\u72d7\u6d4f\u89c8\u5668";if(r&&"Opera"!==o.type){var e=window.external,t=window.clientInformation.languages;return e&&"LiebaoGetVersion"in e?"\u730e\u8c79\u6d4f\u89c8\u5668":0<n.indexOf("bidubrowser")?(o.version=n.match(/bidubrowser\/([\d.]+)/)[1]||n.match(/chrome\/([\d.]+)/)[1],"\u767e\u5ea6\u6d4f\u89c8\u5668"):o.supportSubTitle()&&void 0===t?1<Object.keys(r.webstore).length?"360\u6781\u901f\u6d4f\u89c8\u5668":"360\u5b89\u5168\u6d4f\u89c8\u5668":"Chrome"}return o.type},o.name=o.shell()}catch(i){ee("error")}return o}function le(){var e={};return L(e,ae(),function n(){var e={},t=ue();return e.system_version=t.version,e}(),function r(){var e={},t=ue();return e.brand=t.name,e}(),function t(){var e={};return e.screen_height=document.documentElement.clientHeight,e}(),function o(){var e={};return e.screen_width=document.documentElement.clientWidth,e}()),e}function de(){var e={};return L(e,function t(){var e={};return e[se+"codeName"]=navigator.appCodeName,e}(),ce(),function n(){var e={};return e[se+"resolution"]=window.screen.width+"*"+window.screen.height,e}(),function a(){var e={},t=document.createElement("div");t.style.width="1cm",document.body.appendChild(t);var n=t.offsetWidth,r=window.screen.width/n,o=window.screen.height/n,i=Math.round(Math.sqrt(r*r+o*o)/2.54);return e[se+"screen_size"]=i,document.body.removeChild(t),e}(),function r(){var e={};return e[se+"language"]=navigator.language,e}(),function o(){var e={};return e[se+"userAgent"]=navigator.userAgent,e}(),function i(){var e={};return e[se+"cookieEnabled"]=navigator.cookieEnabled,e}()),e}var fe="bussiness_type",pe="properties",ve="user_id",he="device_id",me="create_time",ge="session_ip",ye="function_id",we="app_ver",be="login",_e="cloud-atlas-web-sdk",xe=null;function Ie(e){for(var t=function x(){return O}(),n=[],r={data:n},o=e.sessionList.length,i=0;i<o;i++){var a=e.sessionList[i],s={};s[fe]=be;var c={};if(c[ye]=21,c[me]=F(new Date(a.start)),a.userId&&(c[ve]=a.userId),c[we]=a.appVer,c[he]=t,c.session_id=a.id,a.ip&&(c[ge]=a.ip),s[pe]=c,n.push(s),0<a.end){var u={};u[fe]=be,(c={})[ye]=22,c[me]=F(new Date(a.end)),a.userId&&(c[ve]=a.userId),c[we]=a.appVer,c.session_id=a.id,c[he]=t,u[pe]=c,n.push(u)}}o=e.eventList.length;for(var l=0;l<o;l++){var d=e.eventList[l],f={};f[fe]="custom_event_log";var p={};if(p.event_tag=d.id,p.event_time=F(new Date(d.time)),p[ve]=d.userId,p[he]=t,p.session_id=d.sessionId,d.appVer&&(p.app_ver=d.appVer),d.value){d.value[k]&&(p.event_label=d.value[k],delete d.value[k]),d.value[S]&&(p.event_value=d.value[S],delete d.value[S]);var v=!1;for(var h in d.value){v=!0;break}v&&(f.ext_properties=d.value)}f[pe]=p,n.push(f)}o=e.errorList.length;for(var m=0;m<o;m++){var g=e.errorList[m],y={};y[fe]="exception_log";var w={};w.ex_type=g.type,w.ex_time=F(new Date(g.time)),w.ex_msg=g.msg,g.appVer&&(w.app_ver=g.appVer),y[pe]=w,n.push(y)}if(0<e.sessionList.length){var b={};b[fe]="device";var _=le();_.channel_id=function I(){return C}(),_[he]=t,_[me]=F(new Date),b[pe]=_,b.ext_properties=de(),n.push(b)}return 0===n.length?null:JSON.stringify(r)}function ke(e,t,n,r){Ee("post",e,t,n,r)}function Se(e){e&&e.onFail&&"function"==typeof e.onFail&&e.onFail("Unknown error")}function Oe(e){e&&e.onFail&&"function"==typeof e.onFail&&e.onFail("Time out")}function Ee(e,t,n,r,o){var i=null,a=r;if(window.XMLHttpRequest){if(!("withCredentials"in(i=new XMLHttpRequest))&&window.XDomainRequest){if("http:"!==window.location.protocol)return ee("sdk just support http protocol"),!1;i=new XDomainRequest}}else if(window.ActiveXObject)try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(s){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(s){}}if(null==i)return ne("Can not create XMLHttpRequest object"),!1;o!==undefined&&null!==o&&o.constructor===Boolean||(o=!0),"post"===e?(window.XDomainRequest&&i.constructor===XDomainRequest?(n=function c(e){var t={};t.body=JSON.parse(e);var n={"Content-type":"application/json"};return t.head=n,JSON.stringify(t)}(n),i.onerror=function(){Se(a)},i.ontimeout=function(){Oe(a)},i.onload=function(){"string"==typeof i.responseText&&""!==i.responseText&&ee("Upload result = "+i.responseText),a&&a.onSuccess&&"function"==typeof a.onSuccess&&a.onSuccess()},i.open(e,t)):(i.open(e,t,o),!function u(){return!!xe}()?i.setRequestHeader("Content-Type","application/json;"):(n=function l(e){var t=e.length,n=j(e),r=xe(n);return ee("origin: "+t+"\uff0cafter compress\uff1a"+r.length),r}(n),i.setRequestHeader("Content-Type","application/gzip;")),i.onreadystatechange=function(){4==i.readyState?200==i.status?("string"==typeof i.responseText&&""!==i.responseText&&ee("Upload result = "+i.responseText),a&&a.onSuccess&&"function"==typeof a.onSuccess&&a.onSuccess()):a&&a.onFail&&"function"==typeof a.onFail&&a.onFail(i.responseText):ee("Upload processed, status = "+i.readyState)}),i.send(n)):(window.XDomainRequest&&i.constructor===XDomainRequest?(i.onerror=function(){Se(a)},i.ontimeout=function(){Oe(a)},i.onload=function(){"string"==typeof i.responseText&&""!==i.responseText&&ee("Upload result = "+i.responseText),a&&a.onSuccess&&"function"==typeof a.onSuccess&&a.onSuccess(i.responseText)},i.open(e,t)):(i.open(e,t,o),i.onreadystatechange=function(){4==i.readyState?200==i.status?("string"==typeof i.responseText&&""!==i.responseText&&ee("Upload result = "+i.responseText),a&&a.onSuccess&&"function"==typeof a.onSuccess&&a.onSuccess(i.responseText)):a&&a.onFail&&"function"==typeof a.onFail&&a.onFail(i.responseText):ee("Upload processed, status = "+i.readyState)}),i.send(null))}function Le(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var n=e.nodeName.toLowerCase();return e&&"body"!==n&&1==e.nodeType?(t.unshift(function r(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:function i(e){var t=[].indexOf;if(!e.parentNode)return-1;var n=e.parentNode.children;if(!n)return-1;var r=n.length;if(t)return t.call(n,e);for(var o=0;o<r;++o)if(e==n[o])return o;return-1}(e);if(e.id)return"#"+e.id;return e.tagName.toLowerCase()+(~t?":nth-child("+(t+1)+")":"")}(e)),e.id?t.join(" > "):Le(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function Ne(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function Ae(e){if(e!==undefined&&null!==e&&"object"===(void 0===e?"undefined":Te(e))){var t=e.eventId;if(t!==undefined&&null!==t&&t.constructor===String){var n=e.label;if(n===undefined||null===n||n.constructor===String){var r=e.info;if(r!==undefined&&null!==r){if("object"!==(void 0===r?"undefined":Te(r)))return void ne("Invalid params for onEvent, info type = "+(void 0===r?"undefined":Te(r))+", value = "+r);for(var o in r)if(r[o]===undefined||null===r[o]||r[o].constructor!==String)return void ne("Invalid params for onEvent, type of info."+o+" = "+Te(r[o])+", value = "+r[o])}var i=e.value;if(i!==undefined&&null!==i){if(i.constructor!==Number)return void ne("Invalid params for onEvent, value type = "+(void 0===i?"undefined":Te(i))+", value = "+i);if(parseInt(i)!==i)return void ne("Invalid params for onEvent, value is not int : "+i)}rt()||nt(),e.callback&&(e.callback(),e.callback()),function a(l){P().then(function(e){var t=l.eventId,n={};if(l.info)for(var r in l.info)n[r]=l.info[r];l.label&&(n[k]=l.label),l.value&&(n[S]=l.value);var o=R(),i=Je(),a=i.userId,s=i.appVer,c=i.sessionId,u=new d(t,n,o,a,s,q,c);W||!x()?(We(u,"eventList"),Ge()):(I(1,u),$e())})}(e)}else ne("Invalid params for onEvent, label type = "+(void 0===n?"undefined":Te(n))+", value = "+n)}else ne("Invalid params for onEvent, eventId type = "+(void 0===t?"undefined":Te(t))+", value = "+t)}else ne("Invalid params for onEvent, type = "+(void 0===e?"undefined":Te(e))+", value = "+e)}function je(e,t,n){Le(t);var r=function a(e){if(!e.target)return!1;var t=e.target,n=t.tagName.toLowerCase(),r={};r.element_id=t.getAttribute("id"),r.element_name=t.getAttribute("name"),r.element_class_name="string"==typeof t.className?t.className:"",r.element_type=n,r.element_target_url=t.getAttribute("href");var o="";return t.textContent?o=Ne(t.textContent):t.innerText&&(o=Ne(t.innerText)),o&&(o=o.replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)),r.element_content=o||"","input"===n&&("button"!==t.type&&"submit"!==t.type||(r.element_content=t.value||"")),(r=function i(e){var t={};for(var n in e)null!=e[n]&&(t[n]=e[n]);return t}(r)).url=location.href,r.url_path=location.pathname,r.title=document.title,r}({target:t});"a"===n?function i(e,r){var o=null;if((e=e||{}).ele&&(o=e.ele),e.event&&(o=e.target?e.target:e.event.target),r=r||{},!o||"object"!==(void 0===o?"undefined":Te(o)))return!1;if(!o.href||/^javascript/.test(o.href)||o.target||o.download||o.onclick)return Pe(r),!1;function t(e){e.stopPropagation(),e.preventDefault();var t=!1;function n(){t||(t=!0,location.href=o.href)}setTimeout(n,1e3),Pe(r,n)}e.event&&t(e.event),e.ele&&ie(e.ele,"click",function(e){t(e)})}({event:e,target:t},r):Pe(r)}function Pe(e,t){Ae(t?{eventId:"AutoPageview",info:e,callback:t}:{eventId:"AutoPageview",info:e})}var Ve=null,Re=null,Fe=null,De=0,Me=[],Ue=0,qe=void 0;function We(e,t){Fe=null,(Fe=new u)[t].push(e)}function ze(){return null==Re&&(Re=new u),Re}function Je(){return Ve}function Ke(){E(Me),Me=null}function $e(){J<=++De&&(Ye(),De=0)}var He=!1,Xe={onSuccess:function(){U&&ee("Upload success"),!W&&x()&&(Ke(),He=!1,Ue=0,Be())},onFail:function(e){te("Upload failed, reason = "+(e||"unknown reason")),!W&&x()&&(He=!1,3<=++Ue&&(Ke(),Ue=0,Be()),Ye())}};function Be(){var e={count:0,isExistSession:!1};if(x()){for(var t=0;t<c.length;t++){var n=c.key(t);/^atlas_data/.test(n)&&e.count++,/^atlas_data_0/.test(n)&&(e.isExistSession=!0)}e.count>=J||e.isExistSession?Ge():!e.isExistSession&&e.count<=J&&(De=e.count)}}function Ge(e){var t=void 0;if(W||!x())t=Fe;else if(0===Ue){var n=b();Me=n.keys,qe=n.data,t=n.data}else t=qe;if(null!==t&&t.hasValidData()){He=!0;var r=Ie(t);null!==r?(U&&ee("Upload = "+r),ke(z+"v0.1/"+function o(){return N}()+"/action/collect",r,Xe,e)):Xe.onSuccess()}}function Ye(e){He||Ge(e)}function Qe(){Ge()}var Ze={onSuccess:function(e){ee("Upload success"),(e=JSON.parse(e)).available&&function t(){ie(document,"click",function(e){var t=e||window.event;if(!t)return!1;var n=t.target||t.srcElement;if("object"!==(void 0===n?"undefined":Te(n)))return!1;if("string"!=typeof n.tagName)return!1;var r=n.tagName.toLowerCase();if("body"===r.toLowerCase()||"html"===r.toLowerCase())return!1;if(!n||!n.parentNode||!n.parentNode.children)return!1;var o=n.parentNode.tagName.toLowerCase();"a"===o||"button"===o||"input"===o?je(t,n.parentNode,n.parentNode.tagName.toLowerCase()):"a"!==r&&"button"!==r&&"input"!==r||je(t,n,r)})}()},onFail:function(e){te("Upload failed, reason = "+(e||"unknown reason"))}},et=!1;function tt(e,t,n,r){try{et?te("Init too many times"):(V(),H(),function o(e,t,n){N=e,T=t,C=n}(e,t,n),function i(){Ve=new l;var n=window.onbeforeunload;window.onbeforeunload=function(){if(Re.sessionList&&0<Re.sessionList.length){var e=R(),t=Re.sessionList[Re.sessionList.length-1];t.end=e,I(0,t)}if(n)return n()}}(),function a(e){if(window.Uint8Array){var t=new Uint8Array([31,139,8,0,0,0,0,0,0,3,75,206,201,47,77,209,77,44,201,73,44,214,45,79,77,210,45,78,201,6,0,249,255,225,61,19,0,0,0]);if(e){if(!function o(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}(t,e(j(_e))))throw"Invalid gzip function";xe=e}else ee("Not to use gzip compress")}else ee("Browser does not support the Unit8Array , will not to use gzip compress")}(r),et=!0)}catch(s){if(ne("Failed to init",s),M)throw s}}function nt(){try{et?P().then(function(e){!function r(e){var t=ze(),n=Je();ot(e,t,n,!0)}(R())}):ne("Not allowed to open session before init")}catch(e){if(ne("Failed to open session",e),M)throw e}}function rt(){var e=ze();return!!(e.sessionList&&0<e.sessionList.length)}function ot(e,t,n,r){var o=function v(){return T}();n.appVer=o;var i=n.userId,a=A(),s=n.ip;if(!r){if(n.sessionId&&0<t.sessionList.length){for(var c=null,u=t.sessionList.length,l=0;l<u;l++){var d=t.sessionList[l];if(d.id===n.sessionId){c=d;break}}null!=c?(c.end=e,W||!x()?(We(c,"sessionList"),Ge()):I(0,c)):ne("No current session object found for sessionId "+n.sessionId)}H()}var f=new m(a,e,0,i,o,s,q);t.sessionList.push(f),W||!x()?(We(t.sessionList[t.sessionList.length-1],"sessionList"),Ge()):(I(0,t.sessionList[t.sessionList.length-1]),Qe()),n.sessionId=a;var p=b();W&&p&&p.data&&p.data.hasValidData()&&(!function h(e){Fe=e}(p.data),Ge(),E(p.keys))}function it(){try{et?P().then(function(e){var t=Je();t.userId?(t.userId=null,ot(R(),ze(),t,!1)):te("No user is login now, no need to logout, maybe something wrong with app")}):ne("Not allowed to sign off before init")}catch(e){if(ne("Failed to sign off",e),M)throw e}}var at=function(){function o(){return new RegExp(/(.*?)\.?([^\.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function i(e,t){var n=e.charAt(0),r=t.split(n);return n===e?r:r[(e=parseInt(e.substring(1),10))<0?r.length+e:e-1]}function a(e,t){for(var n,r=e.charAt(0),o=t.split("&"),i=[],a={},s=[],c=e.substring(1),u=0,l=o.length;u<l;u++)if((i=o[u].match(/(.*?)=(.*)/))||(i=[o[u],o[u],""]),""!==i[1].replace(/\s/g,"")){if(i[2]=(n=i[2]||"",_.decodeURIComponent(n.replace(/\+/g," "))),c===i[1])return i[2];(s=i[1].match(/(.*)\[([0-9]+)\]/))?(a[s[1]]=a[s[1]]||[],a[s[1]][s[2]]=i[2]):a[i[1]]=i[2]}return r===e?a:a[c]}return function(e,t){var n={},r=void 0;if("tld?"===e)return o();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),r=t.match(/^mailto:([^\/].+)/))n.protocol="mailto",n.email=r[1];else{if((r=t.match(/(.*?)\/#\!(.*)/))&&(t=r[1]+r[2]),(r=t.match(/(.*?)#(.*)/))&&(n.hash=r[2],t=r[1]),n.hash&&e.match(/^#/))return a(e,n.hash);if((r=t.match(/(.*?)\?(.*)/))&&(n.query=r[2],t=r[1]),n.query&&e.match(/^\?/))return a(e,n.query);if((r=t.match(/(.*?)\:?\/\/(.*)/))&&(n.protocol=r[1].toLowerCase(),t=r[2]),(r=t.match(/(.*?)(\/.*)/))&&(n.path=r[2],t=r[1]),n.path=(n.path||"").replace(/^([^\/])/,"/$1").replace(/\/$/,""),e.match(/^[\-0-9]+$/)&&(e=e.replace(/^([^\/])/,"/$1")),e.match(/^\//))return i(e,n.path.substring(1));if((r=i("/-1",n.path.substring(1)))&&(r=r.match(/(.*?)\.(.*)/))&&(n.file=r[0],n.filename=r[1],n.fileext=r[2]),(r=t.match(/(.*)\:([0-9]+)$/))&&(n.port=r[2],t=r[1]),(r=t.match(/(.*?)@(.*)/))&&(n.auth=r[1],t=r[2]),n.auth&&(r=n.auth.match(/(.*)\:(.*)/),n.user=r?r[1]:n.auth,n.pass=r?r[2]:undefined),n.hostname=t.toLowerCase(),"."===e.charAt(0))return i(e,n.hostname);o()&&(r=n.hostname.match(o()))&&(n.tld=r[3],n.domain=r[2]?r[2]+"."+r[3]:undefined,n.sub=r[1]||undefined),n.port=n.port||("https"===n.protocol?"443":"80"),n.protocol=n.protocol||("443"===n.port?"https":"http")}return e in n?n[e]:"{}"===e?n:""}}(),st=200;function ct(){var e=function a(e){return"string"!=typeof(e=e||document.referrer)?"\u53d6\u503c\u5f02\u5e38_referrer\u5f02\u5e38_"+String(e):(0===e.indexOf("https://www.baidu.com/")&&(e=e.split("?")[0]),"string"==typeof(e=e.slice(0,st))?e:"")}(),t=document.title,n=e?at(e,"hostname"):e,r=location.href,o=location.pathname,i={referrer:e,referrer_host:n,title:t,url:r,url_path:o};Ae({eventId:"ca_pageview_enter",info:{referrer:e,referrer_host:n,title:t,url:r,url_path:o}}),sessionStorage.setItem(s,JSON.stringify(i))}function ut(e){"ca_pageview_enter"===e?ct():"ca_pageview_leave"===e&&function n(){var e=sessionStorage.getItem(s);if(e){var t=JSON.parse(e);t.url!==location.href&&Ae({eventId:"ca_pageview_leave",info:t})}}()}var lt=function(){function t(e){Ce(this,t),this.has_load_sdk=!1,this.visualSearchName="?ca_show_visual",this.loadVendorCss=!1,this.loadVendorJs=!1,e.appKey!==undefined&&null!==e.appKey&&e.appKey.constructor===String?(this.app_key=e.appKey,this.env=e.env||"INTEGRATION",this.HOST=Y(e.env),this.init(e)):ne("Invalid appKey, type = "+Te(e.appKey)+", value = "+e.appKey)}return t.prototype.init=function(){this.isShowVisual()},t.prototype.browserIsSupport=function(){return!("object"!==Te(window.localStorage)||!window.localStorage.setItem||"object"!==Te(window.sessionStorage)||!window.sessionStorage.setItem)},t.prototype.showErrorTip=function(e){if("object"!==(void 0===e?"undefined":Te(e)))return!1;var t=document.createElement("div"),n=document.createTextNode(e.tip);t.appendChild(n),t.style.cssText="background:#e55b41;border:none;border-radius:8px;color:#fff;font-size:18px;left:50%;margin-left:-300px;padding:15px;position: fixed;text-align: center;top: 0;width:600px;z-index:9999;",document.body.appendChild(t),setTimeout(function(){e.func&&e.func(),t.parentNode.removeChild(t)},e.time)},t.prototype.isShowVisual=function(){var e=location.href,t=this;if(/ca_show_visual$/.test(e)&&2===e.split("ca_show_visual").length){if(!function n(){return!!t.browserIsSupport()||(ne("\u5bf9\u4e0d\u8d77\uff0c\u53ef\u89c6\u5316\u57cb\u70b9\u6682\u4e0d\u652f\u6301\u4f60\u5f53\u524d\u7684\u6d4f\u89c8\u5668\uff0c\u8bf7\u5347\u7ea7\u81f3ie10\u4ee5\u4e0a\uff0c\u63a8\u8350\u4f7f\u7528chrome\uff0cfirefox\uff0csafari\u7b49\u6d4f\u89c8\u5668"),!1)}())return!1;t.enterVisibleMode()}else this.enterNormalMode()},t.prototype.enterVisibleMode=function(){this.has_load_sdk=!0;var e=this.app_key+":/"+this.env+":/";c.setItem("visual_status",e+this.has_load_sdk);var t=this;this.currentUrl=location.href.split("?")[0].replace("ca_show_visual","");var n={app_key:this.app_key,page_identify:this.app_key+this.currentUrl,page_uri:this.currentUrl,page_title:document.title};ke(this.HOST+"v0.1/tracking/web/tracking_page",JSON.stringify(n),{onSuccess:function(e){t.loadFiles()},onFail:function(e){try{ne(JSON.parse(e).message)}catch(t){ne("\u8fdb\u5165\u53ef\u89c6\u5316\u57cb\u70b9\u5931\u8d25")}}})},t.prototype.loadFiles=function(){var e=this.loadVendorCss,t=this.loadVendorJs,n=G.vendorCss,r=G.vendorJs;e||D(n,"link").then(function(e){e||ne("vendor.css\u52a0\u8f7d\u5931\u8d25")}),t||D(r,"script").then(function(e){e||ne("vendor.js\u52a0\u8f7d\u5931\u8d25")})},t.prototype.enterNormalMode=function(){this.has_load_sdk=!1;var e=this.app_key+":/"+this.env+":/";c.setItem("visual_status",e+this.has_load_sdk),this.getDeployData()},t.prototype.getDeployData=function(){var n=this,e=c.getItem("visual_status").split(":/")[0];!function o(e,t,n,r){Ee("get",e,t,n,r)}(Y(c.getItem("visual_status").split(":/")[1])+"v0.1/tracking/web/tracking_event/event_list?app_key="+encodeURIComponent(e)+"&is_deployed=true",null,{onSuccess:function(e){var t=JSON.parse(e);t&&t.content&&t.content.length&&n.listenEvents(t.content)},onFail:function(e){try{ne(JSON.parse(e).message)}catch(t){ne("\u83b7\u53d6\u5df2\u90e8\u7f72\u57cb\u70b9\u6570\u636e\u5931\u8d25")}}})},t.prototype.listenEvents=function(i){var a=this;document.addEventListener("click",function(e){var t=e.target.tagName;if("BODY"===t||"HTML"===t)return!1;var n=(new dt).toAllSelector(e.target),r=i.filter(function(e){return e.type}),o=i.filter(function(e){return e.edit_url===location.href.split("?")[0].replace("ca_show_visual","")&&!e.type});r.some(function(e){return a.trackPoint(e,n)})||o.some(function(e){return a.trackPoint(e,n)})},!0)},t.prototype.trackPoint=function(e,t){var n=t.selfAttr&&t.selfAttr.text?t.selfAttr.text:"";if(e.dom_value!==t.nthEle||e.control_name!==n)return!1;var r={eventId:e.event_name};return e.event_label&&(r.label=e.event_label),Ae(r),!0},t}(),dt=function(){function e(){Ce(this,e)}return e.prototype.getSelfAttr=function(e){var t={},n=e.textContent;return n&&(t.text=n),t},e.prototype.toSelector=function(e){var t=function t(e){return/^[\w-]+$/g.test(e)},n=void 0,r=void 0,o=void 0,i=void 0,a=void 0,s=e.tagName.toLowerCase(),c=e.getAttribute("id");n=null!=(a=e.className)?""===(a=(a=" "+e.className+" ").replace(/^\s+/,"").replace(/\s+$/,""))?[]:a.split(" "):[],i=s,c&&(i+="#"+c),o=function o(e){var t=e.filter(function(e){return""!==e});return t.length?i+"."+t.join("."):i};try{r=o(n)}catch(u){r=o(n=n.filter(t))}return r},e.prototype.toAllSelector=function(e,t){t=t||document;var n=void 0,r=void 0,o=void 0,i=void 0,a=void 0;for(a=this.toSelector(e,t),n=e.parentNode,i=t.querySelectorAll(a).length;"BODY"!==n.tagName&&1!==i;)o=this.toSelector(n)+" "+a,(r=t.querySelectorAll(o).length)<i&&(i=r),a=o,n=n.parentNode;return{nthEle:a,selfAttr:this.getSelfAttr(e)}},e}();return function(){function t(e){Ce(this,t),"Microsoft Internet Explorer"===navigator.appName&&parseInt(navigator.appVersion.split(";")[1].replace(/[ ]/g,"").replace("MSIE",""))<9?ne("\u60a8\u7684\u6d4f\u89c8\u5668\u7248\u672c\u8fc7\u4f4e\uff0c\u4e0d\u652f\u6301web-sdk,\u8bf7\u4e0b\u8f7dIE9+\u6d4f\u89c8\u5668\uff01"):this.init(e)}return t.prototype.init=function(e){try{if(e===undefined||null===e||"object"!==(void 0===e?"undefined":Te(e)))return void ne("Invalid params for init, type = "+(void 0===e?"undefined":Te(e))+", value = "+e);var t=e.appKey,n=e.limitNumber,r=e.isVTrack,o=e.appVer,i=e.channelId,a=e.isDebugMode,s=e.env,c=e.isLog,u=e.isHttps,l=e.isImmediately;if(t===undefined||null===t||t.constructor!==String)return void ne("Invalid appKey, type = "+(void 0===t?"undefined":Te(t))+", value = "+t);if(o===undefined||null===o||o.constructor!==String)return void ne("Invalid appVer, type = "+(void 0===o?"undefined":Te(o))+", value = "+o);255<o.length&&(o=o.substring(0,255));var d=o.replace(/[^a-zA-Z0-9\u4E00-\u9FA5._-]/g,"");if(d!==o&&te("\u7248\u672c\u53f7\u4ec5\u652f\u6301\u4e2d\u6587\uff0c\u82f1\u6587\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e2d\u5212\u7ebf\uff08-\uff09\u3001\u4e0b\u5212\u7ebf\uff08_\uff09\u548c\u70b9\u53f7\uff08.\uff09\uff0c\u5176\u4ed6\u7b26\u53f7\u5c06\u4f1a\u81ea\u52a8\u88ab\u8fc7\u6ee4"),o=d,n!==undefined&&null!==n&&n.constructor===Number&&(n<1?te("\u9650\u5236\u6761\u6570\u6700\u5c0f\u6761\u6570\u4e3a1\u6761\uff0c\u9ed8\u8ba4\u4e3a5\u6761"):100<n?(te("\u9650\u5236\u6761\u6570\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7100\u6761\uff0c\u8d85\u8fc7\u8bbe\u7f6e\u4e3a100\u6761"),$(100)):$(Math.round(n))),i!==undefined&&null!==i)if(i.constructor!==String)ne("Invalid channelId, type = "+(void 0===i?"undefined":Te(i))+", value = "+i);else{201<i.length&&(i=i.substring(0,201));var f=i.replace(/[^a-zA-Z0-9\u4E00-\u9FA5._-]/g,"");f!==i&&te("\u6e20\u9053\u4ec5\u652f\u6301\u4e2d\u6587\uff0c\u82f1\u6587\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e2d\u5212\u7ebf\uff08-\uff09\u3001\u4e0b\u5212\u7ebf\uff08_\uff09\u548c\u70b9\u53f7\uff08.\uff09\uff0c\u5176\u4ed6\u7b26\u53f7\u5c06\u4f1a\u81ea\u52a8\u88ab\u8fc7\u6ee4"),i=f}if(a!==undefined&&null!==a&&a.constructor!==Boolean)return void ne("Invalid isDebugMode, type = "+(void 0===a?"undefined":Te(a))+", value = "+a);var p=undefined;if((s=s||"INTEGRATION").constructor!==String)return void ne("Invalid env, type = "+Te(e.env)+", value = "+e.env);if(c!==undefined&&null!==c&&c.constructor!==Boolean)return void ne("Invalid isLog, type = "+(void 0===c?"undefined":Te(c))+", value = "+c);if(u!==undefined&&null!==u&&u.constructor!==Boolean)return void ne("Invalid isLog, type = "+(void 0===u?"undefined":Te(u))+", value = "+u);if(l!==undefined&&null!==l&&l.constructor!==Boolean)return void ne("Invalid isLog, type = "+(void 0===l?"undefined":Te(l))+", value = "+l);if(l=!1!==l,u=u||!1,function h(e){U=e}(c=c||!1),this.setEnv(s,u),function m(e){W=e}(l),(a=a||!1)&&function g(e){M=e}(a),r&&x()){var v={appKey:e.appKey,env:e.env};this.CloudAtlasVisual=new lt(v)}!function y(e,t,n){Ee("get",e,"",t,n)}(K+"v0.1/config/tracking/"+t,Ze,!0),i===undefined||null===i||i.constructor!==String||""===i?function w(e,t,n){tt(e,t,"default",n)}(t,o,p):tt(t,o,i,p),re(this.leavePage),re(this.sendPage),oe(this.visibilityState),this.sendPage()}catch(b){ne(b)}},t.prototype.visibilityState=function e(){var e=void 0,t=["webkit","moz","ms","o"];"visibilityState"in document&&(e="visibilityState");for(var n=0;n<t.length;n++)if(t[n]+"VisibilityState"in document){e=t[n]+"VisibilityState";break}if("hidden"===document[e]){var r=ze();if(r.sessionList&&0<r.sessionList.length){var o=R(),i=r.sessionList[r.sessionList.length-1];i.end=o,W||!x()?(We(i,"sessionList"),Ge()):I(0,i)}}"visible"===document[e]&&nt()},t.onOpen=function(){nt()},t.onClose=function(){!function t(){try{et?P().then(function(e){ee("Close the page");var t=ze();if(t.sessionList&&0<t.sessionList.length){var n=R(),r=t.sessionList[t.sessionList.length-1];r.end=n,W||!x()?(We(r,"sessionList"),Ge()):(I(0,r),Qe())}else te("No session when page close")}):ne("Not allowed to close session before init")}catch(e){if(ne("Failed to close session",e),M)throw e}}()},t.onProfileSignIn=function(e){e!==undefined&&null!==e&&e.constructor===String&&/^[0-9]*$/.test(e)?function t(o){try{et?P().then(function(e){var t=R(),n=Je(),r=n.userId;r!==o?(r&&it(),n.userId=o,ot(t,ze(),n,!1)):te("Same user, no need to login again")}):ne("Not allowed to sign in before init")}catch(e){if(ne("Failed to sign in",e),M)throw e}}(e):ne("Invalid params for onProfileSignIn, type = "+(void 0===e?"undefined":Te(e))+", value = "+e)},t.onProfileSignOff=function(){it()},t.onEvent=function(e){Ae(e)},t.prototype.onEvent=function(e){Ae(e)},t.reportError=function(e){e!==undefined&&null!==e&&e.constructor===String?(rt()||nt(),function t(o){P().then(function(e){var t=R(),n=Je().appVer,r=new a(0,o,t,n,q);W||!x()?(We(r,"errorList"),Ge()):(I(1,r),$e())})}(e)):ne("Invalid params for reportError, type = "+(void 0===e?"undefined":Te(e))+", value = "+e)},t.prototype.setEnv=function(e,t){!function r(e,t){var n=void 0;switch(e){case"PRODUCTION":n=t?"cloud-atlas-collection.sdp.101.com/":"cloud-atlas-collection.oth.web.sdp.101.com/";break;case"PREPRODUCTION":n=t?"cloud-atlas-collection.beta.101.com/":"cloud-atlas-collection.beta.web.sdp.101.com/";break;case"DEVELOPMENT":n="cloud-atlas-collection.dev.web.nd/";break;case"DEBUG":n="cloud-atlas-collection.debug.web.nd/";break;case"INTEGRATION":n="cloud-atlas-collection.pre1.web.nd/";break;default:n="cloud-atlas-collection.oth.web.sdp.101.com/"}z=t?"https://"+n:"http://"+n}(e,t),function n(e,t){switch(e){case"DEVELOPMENT":K="http://cloud-atlas-server.dev.web.nd/";break;case"DEBUG":K="http://cloud-atlas-server.debug.web.nd/";break;case"INTEGRATION":K="http://cloud-atlas-server.pre1.web.nd/";break;case"PREPRODUCTION":K=t?"https://cloud-atlas-server.beta.101.com/":"http://cloud-atlas-server.beta.101.com/";break;case"PRODUCTION":K=t?"https://cloud-atlas-server.sdp.101.com/":"http://cloud-atlas-server.sdp.101.com/";break;default:K="http://cloud-atlas-server.pre1.web.nd/"}}(e,t)},t.prototype.sendPage=function(){ut("ca_pageview_enter")},t.prototype.leavePage=function(){ut("ca_pageview_leave")},t.freshUpdata=function(){Qe()},t}()});